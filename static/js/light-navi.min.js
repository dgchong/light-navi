$(document).ready(function(){var globalEnvName=null;if(undefined==lightNaviData){console.error('loading light navi data error!');return false;}
effectiveConfig(lightNaviData.config);refreshLeftNav(lightNaviData.config.envs);var sysDataIndex=createIndexSchema();structureSysDataIndex(lightNaviData,sysDataIndex);showSysItems(sysDataIndex.documentStore.docs);$("#search-btn").bind("click",function(){let kws=$("#search-input").val();if($.isEmptyObject(kws)){showSysItems(sysDataIndex.documentStore.docs);return false;}
kws=pinyinUtil.getPinyin(kws);let searchResultArr=sysDataIndex.search(kws,{fields:{name:{boost:1},name_py:{boost:1},desc:{boost:1},desc_py:{boost:1}},bool:"AND",expand:true});let docs=[];if(!$.isEmptyObject(searchResultArr)){for(let i=0,len=searchResultArr.length;i<len;i++){docs.push(searchResultArr[i].doc);}}
showSysItems(docs);});$(document).keyup(function(event){if(event.keyCode==13){$("#search-btn").trigger("click");}});$("#nav-ul li").bind("click",function(){let li=$(this);if(li.hasClass('nav-li-selected')){globalEnvName=null;}else{globalEnvName=$(this).text();li.siblings().removeClass('nav-li-selected');}
li.toggleClass('nav-li-selected');$("#search-btn").trigger("click");});function effectiveConfig(config){let showFooter=config.showFooter;if(!showFooter){$("#ontent-footer").addClass('footer-hidden')}
let defalutEnv=config.defalutEnv;if('all'!=defalutEnv){let index=$.inArray(defalutEnv,config.envs);if(-1<index){globalEnvName=defalutEnv;}}}
function refreshLeftNav(items){if($.isEmptyObject(items)){console.error('config envs data is empty!')
return false;}
let navHtml='';for(item of items){if(item==globalEnvName){navHtml+='<li class="nav-li-selected">'+item+'</li>';}else{navHtml+='<li>'+item+'</li>';}}
$('#nav-ul').html(navHtml);}
function createIndexSchema(){var index=elasticlunr(function(){var fields=['name','name_py','logo','desc','desc_py','env','url'];for(field of fields){this.addField(field);}
this.setRef('id');});return index;}
function structureSysDataIndex(lightNaviData,sysDataIndex){var envs=lightNaviData.config.envs;for(var i=0,len=lightNaviData.data.length;i<len;i++){var sys=lightNaviData.data[i];var urlArr=sys.urls;for(var j=0,lenj=urlArr.length;j<lenj;j++){if((""===urlArr[j])||(null===urlArr[j])){continue;}
if(j>=envs.length){continue;}
var doc={"name":sys.name,"name_py":pinyinUtil.getPinyin(sys.name),"logo":fillDefaultLogo(sys.logo),"desc":sys.desc,"desc_py":pinyinUtil.getPinyin(sys.desc),"env":envs[j],"url":urlArr[j],"id":i*10+j}
sysDataIndex.addDoc(doc);}}}
function fillDefaultLogo(logo){if(!$.isEmptyObject(logo)){return logo;}
return'default.png';}
function showSysItems(docs){var itemsHtml='';if($.isEmptyObject(docs)){itemsHtml='<div class="item-none">empty !</div>';}else{let itemsMap=new Map();$.each(docs,function(i,doc){let env=doc.env;if(null!=globalEnvName){if(env!=globalEnvName){return true;}}
if(itemsMap.has(env)){itemsMap.get(env).push(doc);}else{itemsMap.set(env,[doc]);}});for([key,items]of itemsMap){let envHtml='<fieldset class="item-field">'+'<legend>'+key+'</legend>'+'<div class="field-div">'
for(doc of items){let sysHtml='<a href="'+doc.url+'">'+'<section class="sys-item">'+'<span class="item-logo">'+'<img src="img/'+doc.logo+'" title="'+doc.name+'" />'+'</span>'+'<span class="item-words">'+'<span class="name">'+doc.name+'</span>'+'<span class="desc">'+doc.desc+'</span>'+'</span>'+'</section>'+'</a>'
envHtml=envHtml+sysHtml;}
envHtml+='</div></fieldset>';itemsHtml=itemsHtml+envHtml;}}
$("#content-item").html(itemsHtml);}})